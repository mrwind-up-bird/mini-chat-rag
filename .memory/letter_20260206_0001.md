# Letter to Myself (Session Handoff)

**Date:** 2026-02-06

## 1. Executive Summary
* **Goal:** Building "MiniRAG", a modular, provider-agnostic RAG platform with multi-tenancy — Step 1 of 5 completed.
* **Current Status:** Step 1 fully done. About to start Step 2 (Auth & middleware).

## 2. The "Done" List (Context Anchor)
* Created full project folder structure (`app/api/v1`, `app/core`, `app/models`, `app/services`, `app/workers`)
* Created `docker-compose.yml` with Postgres 16, Qdrant 1.13, Redis 7, web, and worker services (all with healthchecks)
* Created multi-stage `Dockerfile` with `web` and `worker` targets
* Created `pyproject.toml` with hatchling build (key: `[tool.hatch.build.targets.wheel] packages = ["app"]`)
* Implemented `app/core/config.py` — pydantic-settings with `@lru_cache`
* Implemented `app/core/database.py` — async SQLAlchemy engine, session factory, `init_db()`
* Implemented `app/core/security.py` — Argon2 passwords, SHA-256 API token hashing, Fernet field encryption, JWT create/decode
* Implemented `app/models/base.py` — `TimestampMixin`, `utcnow()`, `new_uuid()`
* Implemented `app/models/tenant.py` — `Tenant` table + `TenantCreate`/`TenantRead` schemas
* Implemented `app/models/user.py` — `User` table with `tenant_id` FK, `UserRole` StrEnum, schemas
* Implemented `app/models/api_token.py` — `ApiToken` table (SHA-256 hash only, prefix for display), `ApiTokenCreated` shows raw once
* Implemented `app/main.py` — FastAPI app with lifespan, `/health` endpoint
* Implemented `app/workers/main.py` — ARQ worker placeholder
* Verified: all imports resolve, `GET /health` returns 200

## 3. The "Pain" Log (CRITICAL)
* **Tried:** `pip install -e ".[dev]"` without hatch wheel config
* **Failed:** `ValueError: Unable to determine which files to ship inside the wheel`
* **Workaround:** Added `[tool.hatch.build.targets.wheel] packages = ["app"]` to `pyproject.toml`
* *Note:* Always include this hatch config when project name differs from package directory name.

## 4. Active Variable State
* Python venv at `.venv/` (Python 3.12 on this machine)
* No `.env` file yet — only `.env.example` exists (Docker services not started)
* No database running locally — `init_db()` will create tables on first startup

## 5. Immediate Next Steps
1. [ ] Step 2: Implement bearer token validation dependency (`app/api/deps.py`)
2. [ ] Step 2: Create middleware that resolves API token → `tenant_id` and injects into request state
3. [ ] Step 2: Add tenant registration + API token creation endpoints (bootstrap flow)
4. [ ] Step 2: Test auth flow end-to-end
5. [ ] Step 3: CRUD for BotProfile and Source (all queries filtered by tenant_id)
