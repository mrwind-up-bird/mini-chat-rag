# Checkpoint: Consolidate MODEL_PRICING into shared config

**Date**: 2026-02-11
**Task**: #1 — Consolidate MODEL_PRICING into shared config
**Status**: Completed

## What was done

Eliminated the duplicated MODEL_PRICING dictionary that existed in both the backend (`app/api/v1/stats.py`) and the frontend (`dashboard/index.html`). Created a single source of truth on the backend and exposed it via a new API endpoint.

## Changes

### New file: `app/core/pricing.py`
- Single source of truth for `MODEL_PRICING` dict, `DEFAULT_PRICING` tuple
- Exports `get_pricing(model)` and `calc_cost(model, prompt_tokens, completion_tokens)`

### Modified: `app/api/v1/stats.py`
- Removed the inline `MODEL_PRICING` dict, `_DEFAULT_PRICING`, `_get_pricing()`, and `_calc_cost()`
- Imports `MODEL_PRICING`, `calc_cost`, `get_pricing` from `app.core.pricing`
- Added `ModelPricingEntry` and `PricingResponse` schemas
- Added `GET /v1/stats/pricing` endpoint (auth-required) that returns the full pricing map + default

### Modified: `dashboard/js/api.js`
- Added `getPricing()` method that calls `GET /v1/stats/pricing`

### Modified: `dashboard/index.html`
- Removed the hardcoded `MODEL_PRICING` object and `DEFAULT_PRICING` constant from `usagePage()`
- `load()` now fetches pricing from the API alongside other data using `API.getPricing()`
- `calcRowCost()` reads from the fetched pricing map stored in closure variables

### Modified: `tests/test_stats.py`
- Added `test_pricing_endpoint` — verifies the endpoint returns correct structure and known model data
- Updated `test_new_stats_require_auth` to also check `/v1/stats/pricing`

## Test results
All 87 tests passing.
